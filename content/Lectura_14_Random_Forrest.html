
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Random Forrest &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/Lectura_14_Random_Forrest';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cross-Validation" href="Lectura_15_Cross_Validation.html" />
    <link rel="prev" title="Decision Trees" href="Lectura_13_Arboles_de_decision.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Métodos Estadísticos - Ucentral 2024-II
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lectura_1_Intro.html"><em><strong>Introducción al machine learning</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_2_Analisis_Descriptivo_Multivariado.html"><em><strong>Analisis descriptivo multivariado.</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_3_ACP.html"><em><strong>Analisis de componente principales (PCA).</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_4_ACP_examples.html"><em><strong>PCA: otros ejemplos y algunas funciones útiles.</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_5_AC.html"><em><strong>Análisis de correspondencias simples.</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_6_ACM.html"><em><strong>Análisis de correspondencias multiples.</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_7_Factor_Analysis.html"><em><strong>Análisis Factorial.</strong></em></a></li>

<li class="toctree-l1"><a class="reference internal" href="Lectura_8_Cluster_Jerarquico.html"><em><strong>Clusters jerárquicos.</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_9_Kmeans.html"><em><strong>K-means clustering</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_10_DBSCAN.html"><em><strong>DBSCAN clustering</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_11_Linear_Regression.html"><em><strong>Linear Regression</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_12_Logistic_Regression.html"><em><strong>Logistic Regression</strong></em></a></li>


<li class="toctree-l1"><a class="reference internal" href="Lectura_13_Arboles_de_decision.html"><em><strong>Decision Trees</strong></em></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><em><strong>Random Forrest</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Lectura_15_Cross_Validation.html"><em><strong>Cross-Validation</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="news_clustering.html"><em><strong>Clustering sobre Noticias de “El Tiempo” (Colombia)</strong></em></a></li>
<li class="toctree-l1"><a class="reference internal" href="model_news_clustering.html"><em><strong>Modelado News-Clustering</strong></em></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fcontent/Lectura_14_Random_Forrest.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/Lectura_14_Random_Forrest.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Random Forrest</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#universidad-central"><em><strong>Universidad Central</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos"><em><strong>Maestría en analítica de datos</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-estadisticos-para-analitica-de-datos"><em><strong>Métodos estadísticos para analítica de datos.</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docente-luis-andres-campos-maldonado"><em><strong>Docente: Luis Andrés Campos Maldonado.</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging-y-random-forrest"><em><strong>Bagging y Random Forrest</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging-y-pasting"><em><strong>Bagging y pasting.</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algoritmo-bagging"><em><strong>Algoritmo Bagging</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notas-adicionales"><em><strong>Notas Adicionales:</strong></em></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-bag-evaluation"><em><strong>Out-of-Bag Evaluation</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><em><strong>Random Forrest.</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algoritmo-random-forrest"><em><strong>Algoritmo Random Forrest.</strong></em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nuevo-modelo-de-incumplimiento-de-pago"><em><strong>Nuevo modelo de incumplimiento de pago.</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forrest-buscando-mejorar-decisicion-tree"><em><strong>Random Forrest buscando mejorar Decisicion Tree</strong></em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-con-todas-las-covariables"><em><strong>Modelo con todas las covariables</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance-en-random-forest"><em><strong>Feature Importance en Random Forest</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#impacto-de-las-variables-categoricas"><strong>Impacto de las Variables Categóricas</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion"><strong>Interpretación</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ventajas-y-limitaciones"><strong>Ventajas y Limitaciones</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-bag-oob-en-random-forest"><em><strong>Out-of-Bag (OOB) en Random Forest</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#como-funciona-el-oob"><em><strong>¿Cómo Funciona el OOB?</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-que-el-oob-score-puede-ser-mas-bajo"><em><strong>¿Por qué el OOB Score puede ser más bajo?</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#notas"><em><strong>Notas:</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#como-elegir-un-modelo-de-clasificacion"><em><strong>¿Cómo Elegir un Modelo de Clasificación?</strong></em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones"><em><strong>Conclusiones</strong></em></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="random-forrest">
<h1><em><strong>Random Forrest</strong></em><a class="headerlink" href="#random-forrest" title="Link to this heading">#</a></h1>
<section id="universidad-central">
<h2><em><strong>Universidad Central</strong></em><a class="headerlink" href="#universidad-central" title="Link to this heading">#</a></h2>
</section>
<section id="maestria-en-analitica-de-datos">
<h2><em><strong>Maestría en analítica de datos</strong></em><a class="headerlink" href="#maestria-en-analitica-de-datos" title="Link to this heading">#</a></h2>
</section>
<section id="metodos-estadisticos-para-analitica-de-datos">
<h2><em><strong>Métodos estadísticos para analítica de datos.</strong></em><a class="headerlink" href="#metodos-estadisticos-para-analitica-de-datos" title="Link to this heading">#</a></h2>
</section>
<section id="docente-luis-andres-campos-maldonado">
<h2><em><strong>Docente: Luis Andrés Campos Maldonado.</strong></em><a class="headerlink" href="#docente-luis-andres-campos-maldonado" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">label_binarize</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;ggplot&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>

<span class="n">url_base</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lacamposm/Metodos-Estadisticos/main/data/&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="bagging-y-random-forrest">
<h2><em><strong>Bagging y Random Forrest</strong></em><a class="headerlink" href="#bagging-y-random-forrest" title="Link to this heading">#</a></h2>
<p>Supongamos que hace una pregunta compleja a miles de personas al azar y luego agrega las respuestas, en muchos casos se encontrará que la respuesta agregada es mejor que la respuesta de un experto esto es llamado <em>sabiduría de la multitud</em> <a class="reference external" href="https://en.wikipedia.org/wiki/Wisdom_of_the_crowd">(wisdom of the crowd)</a>. Ahora, pensando en el <em>machine learning</em>, si agregamos las predicciones de un grupo de predictores (clasificador o regresores) a menudo se obtiene mejores predicciones que con el mejor predictor original. Un grupo de predictores se denomina <em>ensemble</em>; luego, esta técnica se denomina <em>Ensemble Learning</em>.</p>
<p>Por ejemplo, puede entrenar un grupo de clasificadores <em>DecisionTree</em>, cada uno en un subconjunto aleatorio del set de train. Para hacer predicciones, solo se obtienen las predicciones de todos los árboles individuales, luego <em><strong>se predice la clase que obtiene la mayor cantidad de votos</strong></em>. Tal conjunto de árboles de decisión se llama Random Forest, y a pesar de su sencillez, es uno de los más potentes algoritmos de Machine Learning disponibles en la actualidad.</p>
<p><em><strong>NOTA:</strong></em></p>
<p>Los metodos de ensamble funcionan mejor cuando los predictores son lo más independientes posible entre sí. Una forma de obtener clasificadores diversos es entrenarlos usando algoritmos muy diferentes. Esto aumenta la posibilidad de que cometan muy diferentes tipos de errores, mejorando la precisión del conjunto.</p>
<section id="bagging-y-pasting">
<h3><em><strong>Bagging y pasting.</strong></em><a class="headerlink" href="#bagging-y-pasting" title="Link to this heading">#</a></h3>
<p>Una forma de obtener un conjunto diverso de clasificadores es usar algoritmos de entrenamiento muy diferentes. Otro enfoque es usar el mismo algoritmo de entrenamiento para todo predictor y entrenarlos en diferentes subconjuntos aleatorios del set de train. Cuando el muestreo se realiza con reemplazo, este método se llama <em>bagging</em> (bootstrap-aggregating). Cuando el muestreo se realiza sin reposición, es llamado <em>pasting</em>.</p>
<p>Tanto en <em>bagging</em> como en <em>pasting</em> se permiten muestrear registros del set de train varias veces a través de múltiples predictores, pero solo el <em>bagging</em> permite a los registro del set de train muestrearse varias veces para el mismo predictor.</p>
<p>Una vez que se entrenan todos los predictores, el <em>ensemble</em> puede hacer una predicción para un nuevo registro simplemente agregando las predicciones de todos los predictores. La <em>aggregation function</em> es normalmente la MODA estadística (es decir, la predicción más frecuente) para la clasificación, o el promedio para la regresión. Cada predictor individual tiene un mayor sesgo que si se entrenara en el set de train original, pero la agregación reduce tanto el sesgo como la varianza. Generalmente, el resultado neto es que el conjunto tiene un sesgo similar pero una varianza menor que un solo predictor entrenado en el set de train  original.</p>
</section>
<section id="algoritmo-bagging">
<h3><em><strong>Algoritmo Bagging</strong></em><a class="headerlink" href="#algoritmo-bagging" title="Link to this heading">#</a></h3>
<p>Supongamos que tenemos una variable respuesta <span class="math notranslate nohighlight">\(Y\)</span> y <span class="math notranslate nohighlight">\(p\)</span> variables predictoras <span class="math notranslate nohighlight">\(\mathbf{X} = (X_1, X_2, \ldots, X_p)\)</span> con <span class="math notranslate nohighlight">\(n\)</span> registros. El Bagging se forma del algoritmo básico para ensembles, excepto que, en lugar de ajustar varios modelos a la misma data, cada nuevo modelo se ajusta a un remuestreo bootstrap.</p>
<p><em><strong>Algoritmo:</strong></em></p>
<ol class="arabic">
<li><p><strong>Inicialización</strong>:</p>
<ul class="simple">
<li><p>Inicialice <span class="math notranslate nohighlight">\(M\)</span>, el número de modelos a ajustar.</p></li>
<li><p>Establezca la iteración <span class="math notranslate nohighlight">\(m = 1\)</span>.</p></li>
</ul>
</li>
<li><p><strong>Generación de Submuestras Bootstrap</strong>:</p>
<ul class="simple">
<li><p>Tome una nueva remuestra de bootstrap (es decir, con reemplazo) de <span class="math notranslate nohighlight">\(n\)</span> registros del conjunto de entrenamiento para formar una submuestra <span class="math notranslate nohighlight">\(Y_m\)</span> y <span class="math notranslate nohighlight">\(\mathbf{X}_m\)</span> (el “bag”).</p></li>
</ul>
</li>
<li><p><strong>Entrenamiento del Modelo</strong>:</p>
<ul class="simple">
<li><p>Entrene un modelo usando <span class="math notranslate nohighlight">\(Y_m\)</span> y <span class="math notranslate nohighlight">\(\mathbf{X}_m\)</span> para crear un conjunto de reglas de decisión <span class="math notranslate nohighlight">\(\hat{f}_m(\mathbf{X})\)</span>.</p></li>
</ul>
</li>
<li><p><strong>Incremento del Contador</strong>:</p>
<ul class="simple">
<li><p>Incrementa el contador del modelo <span class="math notranslate nohighlight">\(m = m + 1\)</span>.</p></li>
<li><p>Si <span class="math notranslate nohighlight">\(m \leq M\)</span>, vuelve al paso 2.</p></li>
</ul>
</li>
<li><p><strong>Combinación de Predicciones</strong>:</p>
<ul>
<li><p><strong>Para Clasificación</strong>:</p>
<ul class="simple">
<li><p>Si <span class="math notranslate nohighlight">\(\hat{f}_m\)</span> predice la probabilidad de que <span class="math notranslate nohighlight">\(Y = 1\)</span>, la estimación bagged viene dada por la votación mayoritaria:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{f}=\frac{1}{M}\left(\hat{f_1}(\mathbf{X})+\hat{f_2}(\mathbf{X})+\cdots+ \hat{f_M}(\mathbf{X})\right)\]</div>
<ul class="simple">
<li><p>Si <span class="math notranslate nohighlight">\(\hat{f}_m\)</span> predice la clase de la instancia, la estimación bagged viene dada por la votación mayoritaria:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{f}= moda\left(\hat{f_1}(\mathbf{X}), \hat{f_2}(\mathbf{X}), \cdots, \hat{f_M}(\mathbf{X})\right)\]</div>
</li>
<li><p><strong>Para Regresión</strong>:</p>
<ul class="simple">
<li><p>Si <span class="math notranslate nohighlight">\(\hat{f}_m\)</span> predice un valor continuo, la estimación bagged viene dada por el promedio de las predicciones:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{f}=\frac{1}{M}\left(\hat{f_1}(\mathbf{X})+\hat{f_2}(\mathbf{X})+\cdots+\hat{f_M}(\mathbf{X})\right)\]</div>
</li>
</ul>
</li>
</ol>
<section id="notas-adicionales">
<h4><em><strong>Notas Adicionales:</strong></em><a class="headerlink" href="#notas-adicionales" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><strong>Tamaño de la Submuestra</strong>: En el paso 2, se menciona que se toma una remuestra de <span class="math notranslate nohighlight">\(n\)</span> registros. Esto es típico en el bagging, donde el tamaño de la submuestra es igual al tamaño del conjunto de datos original. Sin embargo, en algunas variantes, el tamaño de la submuestra puede ser menor que <span class="math notranslate nohighlight">\(n\)</span>.</p></li>
<li><p><strong>Modelos Base</strong>: Los modelos base utilizados en el bagging pueden ser de cualquier tipo, pero los árboles de decisión son comúnmente utilizados debido a su alta varianza y baja capacidad de generalización individual, lo que se compensa al combinarlos en un ensemble.</p></li>
</ul>
</section>
</section>
<section id="out-of-bag-evaluation">
<h3><em><strong>Out-of-Bag Evaluation</strong></em><a class="headerlink" href="#out-of-bag-evaluation" title="Link to this heading">#</a></h3>
<p>Con <em>bagging</em>, algunas instancias se pueden muestrear varias veces para cualquier predictor dado, mientras que otros pueden no ser muestreados en absoluto. Por defecto, un <em>BaggingClassifier</em> toma <span class="math notranslate nohighlight">\(m\)</span> registros del set de train con reemplazo (<code class="docutils literal notranslate"><span class="pre">bootstrap=True</span></code>), donde <span class="math notranslate nohighlight">\(m\)</span> es el tamaño del conjunto de entrenamiento. Esto significa que solo alrededor del <span class="math notranslate nohighlight">\(63\%\)</span> de los registros del set de entrenamiento se muestrean en promedio para cada predictor. El <span class="math notranslate nohighlight">\(37\%\)</span> restante de los registros  que no son muestreados se denominan registros (instancias) <em><strong>out-of-bag (oob)</strong></em>.</p>
<p>Dado que un predictor nunca ve los registros <em>oob</em> durante el entrenamiento, se puede evaluar en
estos registros, sin la necesidad de un set de validación por separado. Es posible evaluar el <em>ensamble</em> promediando las evaluaciones <em>oob</em> de cada predictor.</p>
<p><em><strong>NOTA:</strong></em></p>
<ol class="arabic simple">
<li><p>En Scikit-Learn, puede establecer <code class="docutils literal notranslate"><span class="pre">oob_score=True</span></code> al crear un <em>BaggingClassifier</em> para solicitar una evaluación <em>oob</em> automática después del entrenamiento.</p></li>
<li><p>La función de decisión <em>oob</em> para cada registro del set de train también está disponible a través del atributo <code class="docutils literal notranslate"><span class="pre">oob_decision_function_</span></code>. En este caso que el estimador base tenga un método como <code class="docutils literal notranslate"><span class="pre">predict_proba()</span></code>, la función de decisión devuelve las probabilidades de clase para cada registro del set de train.</p></li>
</ol>
</section>
<section id="id1">
<h3><em><strong>Random Forrest.</strong></em><a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p><em>Random Forrest</em> es un <em>ensemble</em> basado en <em>bagging</em> de <em>DecisionTrees</em>, con una importante extensión: además de muestrear los registros del set de train también muestrea las features. En los <em>DecisionTree</em> tradicionales, para determinar cómo crear una subpartición de un partición <span class="math notranslate nohighlight">\(A\)</span>, el algoritmo elige la variable y el punto de división minimizando un criterio como la impureza de Gini. Con Random Forrest, en cada etapa del algoritmo, la elección de la feature es <em>limitada a un subconjunto aleatorio de features.</em></p>
<p><em><strong>NOTA:</strong></em></p>
<ol class="arabic simple">
<li><p>Generalmente se entrena con <code class="docutils literal notranslate"><span class="pre">max_samples</span></code> ajustado al tamaño del set de train.</p></li>
<li><p>Una regla empírica es elegir <span class="math notranslate nohighlight">\(\sqrt{P}\)</span> donde <span class="math notranslate nohighlight">\(P\)</span> es el número de variables predictoras.</p></li>
</ol>
</section>
<section id="algoritmo-random-forrest">
<h3><em><strong>Algoritmo Random Forrest.</strong></em><a class="headerlink" href="#algoritmo-random-forrest" title="Link to this heading">#</a></h3>
<p>En comparación con el algoritmo de DecisionTree, el algoritmo de Random Forrest agrega dos pasos más: el bagging y el bootstrap sampling de features en cada división:</p>
<ol class="arabic simple">
<li><p>Tome una submuestra de  bootstrap  (con reemplazo) de los registros.</p></li>
<li><p>Para la primera división, muestree <span class="math notranslate nohighlight">\(p&lt; P\)</span> variables al azar sin reemplazo.</p></li>
<li><p>Para cada una de las variables muestreadas <span class="math notranslate nohighlight">\(X_{j(1)}, X_{j(2)},⋯,X_{j(p)}\)</span>, aplicar el siguiente algortimo de división:</p>
<ul class="simple">
<li><p>A) Para cada valor <span class="math notranslate nohighlight">\(s_{j(k)}\)</span> de <span class="math notranslate nohighlight">\(X_{j(k)}\)</span>:</p>
<ul>
<li><p>Divida los registros en la partición <span class="math notranslate nohighlight">\(A\)</span>, con <span class="math notranslate nohighlight">\(X_{j(k)}&lt; s_{j(k)}\)</span> como una partición y los registros restantes donde <span class="math notranslate nohighlight">\(X_{j(k)}≥ s_{j(k)}\)</span> como otra partición.</p></li>
<li><p>Mida la homogeneidad de las clases dentro de cada subpartición de A.</p></li>
</ul>
</li>
<li><p>B) Seleccione el valor de <span class="math notranslate nohighlight">\(s_{j(k)}\)</span> que produce la máxima homogeneidad dentro de la partición
de clase.</p></li>
</ul>
</li>
<li><p>Seleccione la variable <span class="math notranslate nohighlight">\(X_{j(k)}\)</span> y el valor de división <span class="math notranslate nohighlight">\(s_{j(k)}\)</span> que produce la máxima homogeneidad de clase dentro de la partición.</p></li>
<li><p>Seleccione un nuevo subconjunto de <span class="math notranslate nohighlight">\(p\)</span> variables al azar para la siguiente división del árbol, y repita el proceso desde el paso 3 para determinar la mejor división en este nodo.</p></li>
<li><p>Continúe con divisiones adicionales, siguiendo el mismo procedimiento hasta que el árbol logre su máximo crecimiento.</p></li>
<li><p>Vuelva al paso 1, tome otra submuestra de arranque y comience el proceso de nuevo otra vez.</p></li>
</ol>
</section>
</section>
<section id="nuevo-modelo-de-incumplimiento-de-pago">
<h2><em><strong>Nuevo modelo de incumplimiento de pago.</strong></em><a class="headerlink" href="#nuevo-modelo-de-incumplimiento-de-pago" title="Link to this heading">#</a></h2>
<p><em><strong>Problema:</strong></em>  Construir un modelo de clasificación para determinar si un usuario  pagará su préstamo o no.</p>
<p>Nuestra data de trabajo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preparamos la Data</span>
<span class="n">df_prestamos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">url_base</span> <span class="o">+</span> <span class="s2">&quot;Logistic_Regression_1.parquet&quot;</span><span class="p">,)</span>
<span class="n">df_prestamos</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_prestamos</span><span class="p">[</span><span class="s2">&quot;tasa_de_interes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_prestamos</span><span class="p">[</span><span class="s2">&quot;tasa_de_interes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
<span class="n">df_prestamos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>estado_del_prestamo</th>
      <th>ingreso_anual</th>
      <th>estado_de_verificacion</th>
      <th>anios_de_experiencia_laboral</th>
      <th>tenencia_de_vivienda</th>
      <th>tasa_de_interes</th>
      <th>monto_del_prestamo</th>
      <th>proposito</th>
      <th>plazo</th>
      <th>calificacion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>completamente_pagado</td>
      <td>24000.0</td>
      <td>verificado</td>
      <td>10+ años</td>
      <td>alquiler</td>
      <td>10.65</td>
      <td>5000</td>
      <td>tarjeta_de_credito</td>
      <td>36 meses</td>
      <td>B</td>
    </tr>
    <tr>
      <th>1</th>
      <td>dado_de_baja</td>
      <td>30000.0</td>
      <td>verificado_con_fuente</td>
      <td>&lt; 1 año</td>
      <td>alquiler</td>
      <td>15.27</td>
      <td>2500</td>
      <td>auto</td>
      <td>60 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>completamente_pagado</td>
      <td>12252.0</td>
      <td>no_verificado</td>
      <td>10+ años</td>
      <td>alquiler</td>
      <td>15.96</td>
      <td>2400</td>
      <td>pequeno_negocio</td>
      <td>36 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>3</th>
      <td>completamente_pagado</td>
      <td>49200.0</td>
      <td>verificado_con_fuente</td>
      <td>10+ años</td>
      <td>alquiler</td>
      <td>13.49</td>
      <td>10000</td>
      <td>otro</td>
      <td>36 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>completamente_pagado</td>
      <td>80000.0</td>
      <td>verificado_con_fuente</td>
      <td>1 año</td>
      <td>alquiler</td>
      <td>12.69</td>
      <td>3000</td>
      <td>otro</td>
      <td>60 meses</td>
      <td>B</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>38700</th>
      <td>completamente_pagado</td>
      <td>110000.0</td>
      <td>no_verificado</td>
      <td>4 años</td>
      <td>hipoteca</td>
      <td>8.07</td>
      <td>2500</td>
      <td>remodelacion_del_hogar</td>
      <td>36 meses</td>
      <td>A</td>
    </tr>
    <tr>
      <th>38701</th>
      <td>completamente_pagado</td>
      <td>18000.0</td>
      <td>no_verificado</td>
      <td>3 años</td>
      <td>alquiler</td>
      <td>10.28</td>
      <td>8500</td>
      <td>tarjeta_de_credito</td>
      <td>36 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>38702</th>
      <td>completamente_pagado</td>
      <td>100000.0</td>
      <td>no_verificado</td>
      <td>&lt; 1 año</td>
      <td>hipoteca</td>
      <td>8.07</td>
      <td>5000</td>
      <td>consolidacion_de_deudas</td>
      <td>36 meses</td>
      <td>A</td>
    </tr>
    <tr>
      <th>38703</th>
      <td>completamente_pagado</td>
      <td>200000.0</td>
      <td>no_verificado</td>
      <td>&lt; 1 año</td>
      <td>hipoteca</td>
      <td>7.43</td>
      <td>5000</td>
      <td>otro</td>
      <td>36 meses</td>
      <td>A</td>
    </tr>
    <tr>
      <th>38704</th>
      <td>completamente_pagado</td>
      <td>22000.0</td>
      <td>no_verificado</td>
      <td>&lt; 1 año</td>
      <td>propia</td>
      <td>13.75</td>
      <td>7500</td>
      <td>consolidacion_de_deudas</td>
      <td>36 meses</td>
      <td>E</td>
    </tr>
  </tbody>
</table>
<p>38689 rows × 10 columns</p>
</div></div></div>
</div>
<section id="random-forrest-buscando-mejorar-decisicion-tree">
<h3><em><strong>Random Forrest buscando mejorar Decisicion Tree</strong></em><a class="headerlink" href="#random-forrest-buscando-mejorar-decisicion-tree" title="Link to this heading">#</a></h3>
<p>Vamos a ajustar un clasificador Random Forrest con las covariables <code class="docutils literal notranslate"><span class="pre">plazo</span></code> y <code class="docutils literal notranslate"><span class="pre">ingreso_anual</span></code> y generemos la curva ROC asociada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rf1</span> <span class="o">=</span> <span class="n">df_prestamos</span><span class="o">.</span><span class="n">copy</span><span class="p">()[[</span><span class="s2">&quot;estado_del_prestamo&quot;</span><span class="p">,</span> <span class="s2">&quot;ingreso_anual&quot;</span><span class="p">,</span> <span class="s2">&quot;plazo&quot;</span><span class="p">]]</span>
<span class="n">df_rf1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>estado_del_prestamo</th>
      <th>ingreso_anual</th>
      <th>plazo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>completamente_pagado</td>
      <td>24000.0</td>
      <td>36 meses</td>
    </tr>
    <tr>
      <th>1</th>
      <td>dado_de_baja</td>
      <td>30000.0</td>
      <td>60 meses</td>
    </tr>
    <tr>
      <th>2</th>
      <td>completamente_pagado</td>
      <td>12252.0</td>
      <td>36 meses</td>
    </tr>
    <tr>
      <th>3</th>
      <td>completamente_pagado</td>
      <td>49200.0</td>
      <td>36 meses</td>
    </tr>
    <tr>
      <th>4</th>
      <td>completamente_pagado</td>
      <td>80000.0</td>
      <td>60 meses</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>38700</th>
      <td>completamente_pagado</td>
      <td>110000.0</td>
      <td>36 meses</td>
    </tr>
    <tr>
      <th>38701</th>
      <td>completamente_pagado</td>
      <td>18000.0</td>
      <td>36 meses</td>
    </tr>
    <tr>
      <th>38702</th>
      <td>completamente_pagado</td>
      <td>100000.0</td>
      <td>36 meses</td>
    </tr>
    <tr>
      <th>38703</th>
      <td>completamente_pagado</td>
      <td>200000.0</td>
      <td>36 meses</td>
    </tr>
    <tr>
      <th>38704</th>
      <td>completamente_pagado</td>
      <td>22000.0</td>
      <td>36 meses</td>
    </tr>
  </tbody>
</table>
<p>38689 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;plazo&quot;</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ingreso_anual&quot;</span><span class="p">]</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="n">categorical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">)</span>        
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">clf_rf1</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>



<span class="n">X</span> <span class="o">=</span> <span class="n">df_rf1</span><span class="p">[</span><span class="n">categorical_features</span> <span class="o">+</span> <span class="n">numeric_features</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">df_rf1</span><span class="p">[</span><span class="s2">&quot;estado_del_prestamo&quot;</span><span class="p">],</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dado_de_baja&quot;</span><span class="p">,</span> <span class="s2">&quot;completamente_pagado&quot;</span><span class="p">])</span>
<span class="n">clf_rf1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_depth=2, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(max_depth=2, random_state=42)</pre></div> </div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curva de ROC RandomForestClassifier</span>
<span class="n">probas1</span> <span class="o">=</span> <span class="n">clf_rf1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">))[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">probas1</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Random Forrest  (AUC = </span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Randow guess&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Receiver operating characteristic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/830500449de60db72efc7356ec4a34d19fee5791e9d31d9de915315d09db0a0e.png" src="../_images/830500449de60db72efc7356ec4a34d19fee5791e9d31d9de915315d09db0a0e.png" />
</div>
</div>
<p>Podemos ver que hay un aumento en AUC usando el algoritmo de bosque aleatorio. Con solo dos covariables, podemos lograr un aumento bastante significativo en el rendimiento. Esta diferencia probablemente sería más pronunciada con más variables.</p>
</section>
</section>
<section id="modelo-con-todas-las-covariables">
<h2><em><strong>Modelo con todas las covariables</strong></em><a class="headerlink" href="#modelo-con-todas-las-covariables" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_full</span> <span class="o">=</span> <span class="n">df_prestamos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_full</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;estado_de_verificacion&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_full</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>estado_del_prestamo</th>
      <th>ingreso_anual</th>
      <th>anios_de_experiencia_laboral</th>
      <th>tenencia_de_vivienda</th>
      <th>tasa_de_interes</th>
      <th>monto_del_prestamo</th>
      <th>proposito</th>
      <th>plazo</th>
      <th>calificacion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>completamente_pagado</td>
      <td>24000.0</td>
      <td>10+ años</td>
      <td>alquiler</td>
      <td>10.65</td>
      <td>5000</td>
      <td>tarjeta_de_credito</td>
      <td>36 meses</td>
      <td>B</td>
    </tr>
    <tr>
      <th>1</th>
      <td>dado_de_baja</td>
      <td>30000.0</td>
      <td>&lt; 1 año</td>
      <td>alquiler</td>
      <td>15.27</td>
      <td>2500</td>
      <td>auto</td>
      <td>60 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>completamente_pagado</td>
      <td>12252.0</td>
      <td>10+ años</td>
      <td>alquiler</td>
      <td>15.96</td>
      <td>2400</td>
      <td>pequeno_negocio</td>
      <td>36 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>3</th>
      <td>completamente_pagado</td>
      <td>49200.0</td>
      <td>10+ años</td>
      <td>alquiler</td>
      <td>13.49</td>
      <td>10000</td>
      <td>otro</td>
      <td>36 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>completamente_pagado</td>
      <td>80000.0</td>
      <td>1 año</td>
      <td>alquiler</td>
      <td>12.69</td>
      <td>3000</td>
      <td>otro</td>
      <td>60 meses</td>
      <td>B</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>38700</th>
      <td>completamente_pagado</td>
      <td>110000.0</td>
      <td>4 años</td>
      <td>hipoteca</td>
      <td>8.07</td>
      <td>2500</td>
      <td>remodelacion_del_hogar</td>
      <td>36 meses</td>
      <td>A</td>
    </tr>
    <tr>
      <th>38701</th>
      <td>completamente_pagado</td>
      <td>18000.0</td>
      <td>3 años</td>
      <td>alquiler</td>
      <td>10.28</td>
      <td>8500</td>
      <td>tarjeta_de_credito</td>
      <td>36 meses</td>
      <td>C</td>
    </tr>
    <tr>
      <th>38702</th>
      <td>completamente_pagado</td>
      <td>100000.0</td>
      <td>&lt; 1 año</td>
      <td>hipoteca</td>
      <td>8.07</td>
      <td>5000</td>
      <td>consolidacion_de_deudas</td>
      <td>36 meses</td>
      <td>A</td>
    </tr>
    <tr>
      <th>38703</th>
      <td>completamente_pagado</td>
      <td>200000.0</td>
      <td>&lt; 1 año</td>
      <td>hipoteca</td>
      <td>7.43</td>
      <td>5000</td>
      <td>otro</td>
      <td>36 meses</td>
      <td>A</td>
    </tr>
    <tr>
      <th>38704</th>
      <td>completamente_pagado</td>
      <td>22000.0</td>
      <td>&lt; 1 año</td>
      <td>propia</td>
      <td>13.75</td>
      <td>7500</td>
      <td>consolidacion_de_deudas</td>
      <td>36 meses</td>
      <td>E</td>
    </tr>
  </tbody>
</table>
<p>38689 rows × 9 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_full</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;estado_del_prestamo&quot;</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_full</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categorical_features</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;estado_del_prestamo&quot;</span><span class="p">]</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">categorical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">)</span>        
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">clf_rf_full</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
    <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_full</span><span class="p">[</span><span class="n">categorical_features</span> <span class="o">+</span> <span class="n">numeric_features</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">df_full</span><span class="p">[</span><span class="s2">&quot;estado_del_prestamo&quot;</span><span class="p">],</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dado_de_baja&quot;</span><span class="p">,</span> <span class="s2">&quot;completamente_pagado&quot;</span><span class="p">])</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">clf_rf_full</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_depth=3, oob_score=True, random_state=123)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(max_depth=3, oob_score=True, random_state=123)</pre></div> </div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># AUC en train.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">clf_rf_full</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC Train=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># AUC en test.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">clf_rf_full</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC Test=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;False Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Receiver operating characteristic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Randow guess&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/77e5ca068159af62defc9a0dd2b1b7d5bf39495d1729dab38347ebae12c04b22.png" src="../_images/77e5ca068159af62defc9a0dd2b1b7d5bf39495d1729dab38347ebae12c04b22.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_rf_full2</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
    <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">300</span>
<span class="p">)</span>

<span class="n">clf_rf_full2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># AUC en train.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">clf_rf_full2</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC Train=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># AUC en test.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">clf_rf_full2</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC Test=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;False Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Receiver operating characteristic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Randow guess&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1278133f281d73e08fbb4c72a2098686a7f0e347f29f2c0eca9dd952563f19af.png" src="../_images/1278133f281d73e08fbb4c72a2098686a7f0e347f29f2c0eca9dd952563f19af.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_rf_full3</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;gini&quot;</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># AUC en train.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC Train=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># AUC en test.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC Test=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;False Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Receiver operating characteristic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Randow guess&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6d9d15a3387f539c02fe75877ebe73dfb900393b678f915f39a2d9430ecb536f.png" src="../_images/6d9d15a3387f539c02fe75877ebe73dfb900393b678f915f39a2d9430ecb536f.png" />
</div>
</div>
</section>
<section id="feature-importance-en-random-forest">
<h2><em><strong>Feature Importance en Random Forest</strong></em><a class="headerlink" href="#feature-importance-en-random-forest" title="Link to this heading">#</a></h2>
<p>La <strong>feature importance</strong> mide la relevancia de cada característica para las predicciones del modelo. En <strong>Random Forest</strong>, se calcula mediante:</p>
<ul class="simple">
<li><p><strong>Reducción Promedio de la Impureza (MDI):</strong></p>
<ul>
<li><p>Calcula cuánto reduce la impureza (Gini o entropía) al usar una característica para dividir un nodo.</p></li>
<li><p>Predeterminado en scikit-learn.</p></li>
</ul>
</li>
</ul>
<section id="impacto-de-las-variables-categoricas">
<h3><strong>Impacto de las Variables Categóricas</strong><a class="headerlink" href="#impacto-de-las-variables-categoricas" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Las variables categóricas con muchas categorías o pocas observaciones en ciertas categorías pueden sesgar la importancia.</p></li>
<li><p><strong>Categorías poco representadas:</strong></p>
<ul>
<li><p>Contribuyen menos al modelo por la falta de información estadística.</p></li>
<li><p>Pueden aumentar el riesgo de sobreajuste si capturan ruido en lugar de patrones reales.</p></li>
</ul>
</li>
</ul>
</section>
<section id="interpretacion">
<h3><strong>Interpretación</strong><a class="headerlink" href="#interpretacion" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Valores más altos indican mayor relevancia de una característica.</p></li>
<li><p>Ayuda a identificar las variables clave y eliminar las irrelevantes.</p></li>
</ul>
</section>
<section id="ventajas-y-limitaciones">
<h3><strong>Ventajas y Limitaciones</strong><a class="headerlink" href="#ventajas-y-limitaciones" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Ventajas:</strong> Intuitivo, útil para simplificar modelos.</p></li>
<li><p><strong>Limitaciones:</strong></p>
<ol class="arabic simple">
<li><p>Sesgo hacia variables categóricas con muchas categorías.</p></li>
<li><p>Poca utilidad de categorías infrecuentes.</p></li>
<li><p>Dificultad para capturar interacciones.</p></li>
<li><p>Dependencia del método (MDI puede sobrestimar; MDA es más preciso).</p></li>
</ol>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoded_categorical_names</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
<span class="n">numeric_names</span> <span class="o">=</span> <span class="n">numeric_features</span>
<span class="n">transformed_feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">encoded_categorical_names</span><span class="p">)</span> <span class="o">+</span> <span class="n">numeric_names</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">importance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Feature&quot;</span><span class="p">:</span> <span class="n">transformed_feature_names</span><span class="p">,</span> <span class="s2">&quot;Importance&quot;</span><span class="p">:</span> <span class="n">importances</span><span class="p">})</span>
<span class="n">importance_df</span> <span class="o">=</span> <span class="n">importance_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">importance_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature</th>
      <th>Importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>tasa_de_interes</td>
      <td>0.297144</td>
    </tr>
    <tr>
      <th>1</th>
      <td>plazo_ 36 meses</td>
      <td>0.132306</td>
    </tr>
    <tr>
      <th>2</th>
      <td>plazo_ 60 meses</td>
      <td>0.131824</td>
    </tr>
    <tr>
      <th>3</th>
      <td>calificacion_A</td>
      <td>0.111486</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ingreso_anual</td>
      <td>0.070003</td>
    </tr>
    <tr>
      <th>5</th>
      <td>proposito_pequeno_negocio</td>
      <td>0.049825</td>
    </tr>
    <tr>
      <th>6</th>
      <td>calificacion_E</td>
      <td>0.033946</td>
    </tr>
    <tr>
      <th>7</th>
      <td>calificacion_D</td>
      <td>0.032778</td>
    </tr>
    <tr>
      <th>8</th>
      <td>calificacion_F</td>
      <td>0.028853</td>
    </tr>
    <tr>
      <th>9</th>
      <td>calificacion_B</td>
      <td>0.021430</td>
    </tr>
    <tr>
      <th>10</th>
      <td>monto_del_prestamo</td>
      <td>0.019959</td>
    </tr>
    <tr>
      <th>11</th>
      <td>calificacion_C</td>
      <td>0.012219</td>
    </tr>
    <tr>
      <th>12</th>
      <td>proposito_tarjeta_de_credito</td>
      <td>0.010679</td>
    </tr>
    <tr>
      <th>13</th>
      <td>tenencia_de_vivienda_hipoteca</td>
      <td>0.006361</td>
    </tr>
    <tr>
      <th>14</th>
      <td>calificacion_G</td>
      <td>0.006122</td>
    </tr>
    <tr>
      <th>15</th>
      <td>anios_de_experiencia_laboral_10+ años</td>
      <td>0.003412</td>
    </tr>
    <tr>
      <th>16</th>
      <td>tenencia_de_vivienda_alquiler</td>
      <td>0.002975</td>
    </tr>
    <tr>
      <th>17</th>
      <td>proposito_remodelacion_del_hogar</td>
      <td>0.002744</td>
    </tr>
    <tr>
      <th>18</th>
      <td>proposito_consolidacion_de_deudas</td>
      <td>0.002609</td>
    </tr>
    <tr>
      <th>19</th>
      <td>proposito_boda</td>
      <td>0.002207</td>
    </tr>
    <tr>
      <th>20</th>
      <td>proposito_auto</td>
      <td>0.001956</td>
    </tr>
    <tr>
      <th>21</th>
      <td>proposito_mudanza</td>
      <td>0.001829</td>
    </tr>
    <tr>
      <th>22</th>
      <td>proposito_otro</td>
      <td>0.001725</td>
    </tr>
    <tr>
      <th>23</th>
      <td>proposito_casa</td>
      <td>0.001575</td>
    </tr>
    <tr>
      <th>24</th>
      <td>proposito_compra_importante</td>
      <td>0.001543</td>
    </tr>
    <tr>
      <th>25</th>
      <td>anios_de_experiencia_laboral_3 años</td>
      <td>0.001228</td>
    </tr>
    <tr>
      <th>26</th>
      <td>anios_de_experiencia_laboral_2 años</td>
      <td>0.001032</td>
    </tr>
    <tr>
      <th>27</th>
      <td>proposito_vacaciones</td>
      <td>0.000919</td>
    </tr>
    <tr>
      <th>28</th>
      <td>anios_de_experiencia_laboral_&lt; 1 año</td>
      <td>0.000915</td>
    </tr>
    <tr>
      <th>29</th>
      <td>tenencia_de_vivienda_propia</td>
      <td>0.000871</td>
    </tr>
    <tr>
      <th>30</th>
      <td>tenencia_de_vivienda_otro</td>
      <td>0.000818</td>
    </tr>
    <tr>
      <th>31</th>
      <td>proposito_educativo</td>
      <td>0.000775</td>
    </tr>
    <tr>
      <th>32</th>
      <td>proposito_gastos_medicos</td>
      <td>0.000752</td>
    </tr>
    <tr>
      <th>33</th>
      <td>anios_de_experiencia_laboral_9 años</td>
      <td>0.000717</td>
    </tr>
    <tr>
      <th>34</th>
      <td>proposito_energia_renovable</td>
      <td>0.000716</td>
    </tr>
    <tr>
      <th>35</th>
      <td>anios_de_experiencia_laboral_4 años</td>
      <td>0.000697</td>
    </tr>
    <tr>
      <th>36</th>
      <td>anios_de_experiencia_laboral_8 años</td>
      <td>0.000679</td>
    </tr>
    <tr>
      <th>37</th>
      <td>anios_de_experiencia_laboral_7 años</td>
      <td>0.000678</td>
    </tr>
    <tr>
      <th>38</th>
      <td>anios_de_experiencia_laboral_1 año</td>
      <td>0.000643</td>
    </tr>
    <tr>
      <th>39</th>
      <td>anios_de_experiencia_laboral_5 años</td>
      <td>0.000554</td>
    </tr>
    <tr>
      <th>40</th>
      <td>anios_de_experiencia_laboral_6 años</td>
      <td>0.000496</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">importance_df</span><span class="p">[</span><span class="s2">&quot;Feature&quot;</span><span class="p">],</span> <span class="n">importance_df</span><span class="p">[</span><span class="s2">&quot;Importance&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Importancia&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature Importance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14ef1385151cb05d702e6c81c746a4d4df6cf9aa3db37b5cd096464a2b080653.png" src="../_images/14ef1385151cb05d702e6c81c746a4d4df6cf9aa3db37b5cd096464a2b080653.png" />
</div>
</div>
</section>
</section>
<section id="out-of-bag-oob-en-random-forest">
<h2><em><strong>Out-of-Bag (OOB) en Random Forest</strong></em><a class="headerlink" href="#out-of-bag-oob-en-random-forest" title="Link to this heading">#</a></h2>
<p>El <em><strong>Out-of-Bag (OOB)</strong></em> es una técnica útil para evaluar el rendimiento de un modelo de <em><strong>Random Forest</strong></em> durante el entrenamiento, sin necesidad de un conjunto de validación separado.</p>
<section id="como-funciona-el-oob">
<h3><em><strong>¿Cómo Funciona el OOB?</strong></em><a class="headerlink" href="#como-funciona-el-oob" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><em><strong>Selección de Datos por Bootstrap:</strong></em></p>
<ul class="simple">
<li><p>Cada árbol se entrena con un subconjunto de los datos seleccionados mediante muestreo con reemplazo.</p></li>
<li><p>Las instancias no seleccionadas forman los datos <em><strong>Out-of-Bag (OOB)</strong></em> para ese árbol.</p></li>
</ul>
</li>
<li><p><em><strong>Predicciones OOB:</strong></em></p>
<ul class="simple">
<li><p>Cada instancia es evaluada únicamente por los árboles donde no participó durante el entrenamiento.</p></li>
<li><p>Las predicciones finales de una instancia OOB son agregadas (por voto mayoritario o promedio) de todos los árboles donde fue OOB.</p></li>
</ul>
</li>
<li><p><em><strong>Cálculo del OOB Score:</strong></em></p>
<ul class="simple">
<li><p>Se compara la predicción agregada con las etiquetas reales para calcular una métrica global, como exactitud o AUC.</p></li>
<li><p>Este puntaje representa una estimación conservadora del rendimiento del modelo.</p></li>
</ul>
</li>
</ol>
</section>
<section id="por-que-el-oob-score-puede-ser-mas-bajo">
<h3><em><strong>¿Por qué el OOB Score puede ser más bajo?</strong></em><a class="headerlink" href="#por-que-el-oob-score-puede-ser-mas-bajo" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><em><strong>Menos Árboles Contribuyen:</strong></em></p>
<ul class="simple">
<li><p>El OOB Score usa solo los árboles donde la instancia fue OOB, lo que resulta en menos contribuciones para cada predicción, aumentando la varianza.</p></li>
</ul>
</li>
<li><p><em><strong>Evaluación Estricta:</strong></em></p>
<ul class="simple">
<li><p>Las instancias OOB son tratadas como datos “no vistos” por los árboles que las evalúan, lo que simula un conjunto de validación más estricto.</p></li>
</ul>
</li>
<li><p><em><strong>Generalización Conservadora:</strong></em></p>
<ul class="simple">
<li><p>Al no beneficiarse del conocimiento de todos los árboles, el OOB Score tiende a ser más bajo que el rendimiento en el conjunto de entrenamiento o incluso en un conjunto de prueba separado.</p></li>
</ul>
</li>
</ol>
</section>
<section id="notas">
<h3><em><strong>Notas:</strong></em><a class="headerlink" href="#notas" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><em><strong>Evaluación Comparable:</strong></em> Aunque es más conservador, el OOB Score puede reflejar mejor cómo el modelo generalizará en datos no vistos.</p></li>
<li><p><em><strong>Sesgo en Datos Desbalanceados:</strong></em> En conjuntos con clases altamente desbalanceadas, el OOB Score puede subestimar el rendimiento real debido al sesgo hacia la clase mayoritaria.</p></li>
<li><p><em><strong>No Sustituye al Conjunto de Prueba:</strong></em> Si bien es útil como estimación inicial, el OOB Score no reemplaza la evaluación en un conjunto de prueba externo para medir la capacidad de generalización.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">oob_decision_function_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.142356</td>
      <td>0.857644</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.066600</td>
      <td>0.933400</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.282172</td>
      <td>0.717828</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.253039</td>
      <td>0.746961</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.107753</td>
      <td>0.892247</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>30946</th>
      <td>0.152940</td>
      <td>0.847060</td>
    </tr>
    <tr>
      <th>30947</th>
      <td>0.142514</td>
      <td>0.857486</td>
    </tr>
    <tr>
      <th>30948</th>
      <td>0.197629</td>
      <td>0.802371</td>
    </tr>
    <tr>
      <th>30949</th>
      <td>0.081787</td>
      <td>0.918213</td>
    </tr>
    <tr>
      <th>30950</th>
      <td>0.131068</td>
      <td>0.868932</td>
    </tr>
  </tbody>
</table>
<p>30951 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.143918</td>
      <td>0.856082</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.066585</td>
      <td>0.933415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.280503</td>
      <td>0.719497</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.258214</td>
      <td>0.741786</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.107117</td>
      <td>0.892883</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>30946</th>
      <td>0.149155</td>
      <td>0.850845</td>
    </tr>
    <tr>
      <th>30947</th>
      <td>0.143554</td>
      <td>0.856446</td>
    </tr>
    <tr>
      <th>30948</th>
      <td>0.184611</td>
      <td>0.815389</td>
    </tr>
    <tr>
      <th>30949</th>
      <td>0.098721</td>
      <td>0.901279</td>
    </tr>
    <tr>
      <th>30950</th>
      <td>0.128493</td>
      <td>0.871507</td>
    </tr>
  </tbody>
</table>
<p>30951 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># AUC en train.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC Train=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># AUC en test.</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">clf_rf_full3</span><span class="o">.</span><span class="n">oob_decision_function_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RandomForestClassifier (AUC OOB=</span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;False Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Receiver operating characteristic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Randow guess&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14b4116a3d6f00c5a840b625b7245e702dbbc1302da1016661a0daf044b8fd82.png" src="../_images/14b4116a3d6f00c5a840b625b7245e702dbbc1302da1016661a0daf044b8fd82.png" />
</div>
</div>
</section>
<section id="como-elegir-un-modelo-de-clasificacion">
<h3><em><strong>¿Cómo Elegir un Modelo de Clasificación?</strong></em><a class="headerlink" href="#como-elegir-un-modelo-de-clasificacion" title="Link to this heading">#</a></h3>
<p>La elección del modelo de clasificación depende de múltiples factores, siendo el rendimiento predictivo, como el AUC (Área bajo la curva), uno de los más importantes. Sin embargo, cuando el rendimiento de los modelos es similar, como en este caso, donde todos los modelos tienen resultados comparables, la decisión puede basarse en otros criterios como la varianza, la eficiencia computacional y el propósito del análisis.</p>
<p><em><strong>Criterios para la Selección del Modelo</strong></em></p>
<ol class="arabic simple">
<li><p><em><strong>Finalidad del análisis</strong></em></p>
<ul class="simple">
<li><p>Si buscas un clasificador rápido y sencillo, los bosques aleatorios son una buena opción con configuraciones predeterminadas.</p></li>
<li><p>Si los datos tienen patrones bien entendidos, podrías usar la regresión logística con transformaciones manuales para capturar esos patrones.</p></li>
</ul>
</li>
<li><p><em><strong>Tamaño del conjunto de datos</strong></em></p></li>
</ol>
<ul class="simple">
<li><p>Con grandes volúmenes de datos:</p>
<ul>
<li><p>Los bosques aleatorios y la regresión logística pueden volverse computacionalmente costosos debido a su complejidad.</p></li>
<li><p>Los bosques aleatorios son más adecuados cuando los datos son ricos y tienen interacciones complejas, aunque entrenarlos en grandes conjuntos de datos requiere más recursos.</p></li>
</ul>
</li>
</ul>
<ol class="arabic simple" start="3">
<li><p><em><strong>Número de covariables</strong></em></p></li>
</ol>
<ul class="simple">
<li><p>Cuando el número de covariables es pequeño, tanto los bosques aleatorios como la regresión logística se desempeñan bien.</p></li>
<li><p>A medida que aumenta el número de covariables:</p>
<ul>
<li><p>Los bosques aleatorios capturan mejor las interacciones complejas.</p></li>
<li><p>La regresión logística podría requerir regularización para evitar sobreajuste.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="conclusiones">
<h2><em><strong>Conclusiones</strong></em><a class="headerlink" href="#conclusiones" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><em><strong>Diferencias entre modelos</strong></em></p>
<ul class="simple">
<li><p>Los bosques aleatorios son más lentos, pero capturan relaciones no lineales y patrones complejos en los datos.</p></li>
<li><p>La regresión logística, aunque más rápida y directa, puede no capturar interacciones no lineales sin agregar transformaciones explícitas.</p></li>
</ul>
</li>
<li><p><em><strong>Desempeño similar en el caso actual</strong></em></p>
<ul class="simple">
<li><p>Ambos modelos mostraron un desempeño similar debido al tamaño mediano del conjunto de datos y el número limitado de covariables.</p></li>
<li><p>La ausencia de sobreajuste sugiere que los datos son suficientes para un entrenamiento adecuado sin complejidad adicional.</p></li>
</ul>
</li>
<li><p><em><strong>Extensibilidad de los modelos</strong></em></p>
<ul class="simple">
<li><p><strong>Bosques aleatorios:</strong></p>
<ul>
<li><p>Requieren ajuste fino de parámetros, como el número de árboles y la profundidad, para optimizar el desempeño según las características de los datos.</p></li>
</ul>
</li>
<li><p><strong>Regresión logística:</strong></p>
<ul>
<li><p>Puede beneficiarse de la regularización y es más adecuada para conjuntos de datos más pequeños y con menor complejidad.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><em><strong>La selección del modelo debe considerar el equilibrio entre:</strong></em></p>
<ul class="simple">
<li><p><strong>Propósito del análisis:</strong> ¿Es una prueba rápida o un modelo optimizado para producción?</p></li>
<li><p><strong>Eficiencia computacional:</strong> ¿Cuántos datos y covariables tiene el problema?</p></li>
<li><p><strong>Capacidad del modelo para generalizar:</strong> ¿Los datos son lo suficientemente ricos para aprovechar modelos más complejos?</p></li>
</ul>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Lectura_13_Arboles_de_decision.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><em><strong>Decision Trees</strong></em></p>
      </div>
    </a>
    <a class="right-next"
       href="Lectura_15_Cross_Validation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><em><strong>Cross-Validation</strong></em></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#universidad-central"><em><strong>Universidad Central</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos"><em><strong>Maestría en analítica de datos</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-estadisticos-para-analitica-de-datos"><em><strong>Métodos estadísticos para analítica de datos.</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docente-luis-andres-campos-maldonado"><em><strong>Docente: Luis Andrés Campos Maldonado.</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging-y-random-forrest"><em><strong>Bagging y Random Forrest</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging-y-pasting"><em><strong>Bagging y pasting.</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algoritmo-bagging"><em><strong>Algoritmo Bagging</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notas-adicionales"><em><strong>Notas Adicionales:</strong></em></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-bag-evaluation"><em><strong>Out-of-Bag Evaluation</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><em><strong>Random Forrest.</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algoritmo-random-forrest"><em><strong>Algoritmo Random Forrest.</strong></em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nuevo-modelo-de-incumplimiento-de-pago"><em><strong>Nuevo modelo de incumplimiento de pago.</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forrest-buscando-mejorar-decisicion-tree"><em><strong>Random Forrest buscando mejorar Decisicion Tree</strong></em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-con-todas-las-covariables"><em><strong>Modelo con todas las covariables</strong></em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance-en-random-forest"><em><strong>Feature Importance en Random Forest</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#impacto-de-las-variables-categoricas"><strong>Impacto de las Variables Categóricas</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion"><strong>Interpretación</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ventajas-y-limitaciones"><strong>Ventajas y Limitaciones</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-bag-oob-en-random-forest"><em><strong>Out-of-Bag (OOB) en Random Forest</strong></em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#como-funciona-el-oob"><em><strong>¿Cómo Funciona el OOB?</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-que-el-oob-score-puede-ser-mas-bajo"><em><strong>¿Por qué el OOB Score puede ser más bajo?</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#notas"><em><strong>Notas:</strong></em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#como-elegir-un-modelo-de-clasificacion"><em><strong>¿Cómo Elegir un Modelo de Clasificación?</strong></em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones"><em><strong>Conclusiones</strong></em></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Luis Andres Campos
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>