Traceback (most recent call last):
  File "/home/andres-campos/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/home/andres-campos/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/nbclient/client.py", line 1314, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/home/andres-campos/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
  File "/usr/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/home/andres-campos/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/home/andres-campos/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/home/andres-campos/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
xgb_regressor = XGBRegressor(objective="reg:squarederror")

pipeline_xgb = Pipeline(steps=[
    ("preprocessor", preprocessor),
    ("model", xgb_regressor)
])

param_distributions = {
    "model__max_depth": [3, 4, 5, 6],
    "model__n_estimators": [100, 500, 1000],
    "model__learning_rate": [0.0075, 0.01, 0.05],
    "model__reg_alpha": [0, 5, 10, 15, 20],
    "model__reg_lambda": [1, 10, 20, 30],
    "model__subsample": [0.6, 0.8, 1.0],
    "model__max_leaves": [100, 200, 300, 500]
}

random_search_xgb = RandomizedSearchCV(
    estimator=pipeline_xgb,
    param_distributions=param_distributions,
    n_iter=10,
    scoring="r2",
    cv=5,
    random_state=42,
    n_jobs=-1,
    return_train_score=True
)

random_search_xgb.fit(X_train, y_train)

print("Best parameters found: ", random_search_xgb.best_params_)
print(f"Best CV score: {random_search_xgb.best_score_}")

best_model = random_search_xgb.best_estimator_
print(f"R2 en Train: {best_model.score(X_train, y_train):.4f}")
print(f"R2 en Test:  {best_model.score(X_test, y_test):.4f}")

pd.DataFrame(random_search_xgb.cv_results_).to_parquet("data/xgb_cv_search.parquet")
------------------

----- stdout -----
Best parameters found:  {'model__subsample': 0.8, 'model__reg_lambda': 1, 'model__reg_alpha': 10, 'model__n_estimators': 1000, 'model__max_leaves': 300, 'model__max_depth': 3, 'model__learning_rate': 0.05}
Best CV score: 0.8905389750992884
R2 en Train: 0.9461
R2 en Test:  0.8828
------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mOSError[0m                                   Traceback (most recent call last)
Cell [0;32mIn[12], line 38[0m
[1;32m     35[0m [38;5;28mprint[39m([38;5;124mf[39m[38;5;124m"[39m[38;5;124mR2 en Train: [39m[38;5;132;01m{[39;00mbest_model[38;5;241m.[39mscore(X_train,[38;5;250m [39my_train)[38;5;132;01m:[39;00m[38;5;124m.4f[39m[38;5;132;01m}[39;00m[38;5;124m"[39m)
[1;32m     36[0m [38;5;28mprint[39m([38;5;124mf[39m[38;5;124m"[39m[38;5;124mR2 en Test:  [39m[38;5;132;01m{[39;00mbest_model[38;5;241m.[39mscore(X_test,[38;5;250m [39my_test)[38;5;132;01m:[39;00m[38;5;124m.4f[39m[38;5;132;01m}[39;00m[38;5;124m"[39m)
[0;32m---> 38[0m [43mpd[49m[38;5;241;43m.[39;49m[43mDataFrame[49m[43m([49m[43mrandom_search_xgb[49m[38;5;241;43m.[39;49m[43mcv_results_[49m[43m)[49m[38;5;241;43m.[39;49m[43mto_parquet[49m[43m([49m[38;5;124;43m"[39;49m[38;5;124;43mdata/xgb_cv_search.parquet[39;49m[38;5;124;43m"[39;49m[43m)[49m

File [0;32m~/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/pandas/util/_decorators.py:333[0m, in [0;36mdeprecate_nonkeyword_arguments.<locals>.decorate.<locals>.wrapper[0;34m(*args, **kwargs)[0m
[1;32m    327[0m [38;5;28;01mif[39;00m [38;5;28mlen[39m(args) [38;5;241m>[39m num_allow_args:
[1;32m    328[0m     warnings[38;5;241m.[39mwarn(
[1;32m    329[0m         msg[38;5;241m.[39mformat(arguments[38;5;241m=[39m_format_argument_list(allow_args)),
[1;32m    330[0m         [38;5;167;01mFutureWarning[39;00m,
[1;32m    331[0m         stacklevel[38;5;241m=[39mfind_stack_level(),
[1;32m    332[0m     )
[0;32m--> 333[0m [38;5;28;01mreturn[39;00m [43mfunc[49m[43m([49m[38;5;241;43m*[39;49m[43margs[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m)[49m

File [0;32m~/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/pandas/core/frame.py:3113[0m, in [0;36mDataFrame.to_parquet[0;34m(self, path, engine, compression, index, partition_cols, storage_options, **kwargs)[0m
[1;32m   3032[0m [38;5;250m[39m[38;5;124;03m"""[39;00m
[1;32m   3033[0m [38;5;124;03mWrite a DataFrame to the binary parquet format.[39;00m
[1;32m   3034[0m 
[0;32m   (...)[0m
[1;32m   3109[0m [38;5;124;03m>>> content = f.read()[39;00m
[1;32m   3110[0m [38;5;124;03m"""[39;00m
[1;32m   3111[0m [38;5;28;01mfrom[39;00m [38;5;21;01mpandas[39;00m[38;5;21;01m.[39;00m[38;5;21;01mio[39;00m[38;5;21;01m.[39;00m[38;5;21;01mparquet[39;00m [38;5;28;01mimport[39;00m to_parquet
[0;32m-> 3113[0m [38;5;28;01mreturn[39;00m [43mto_parquet[49m[43m([49m
[1;32m   3114[0m [43m    [49m[38;5;28;43mself[39;49m[43m,[49m
[1;32m   3115[0m [43m    [49m[43mpath[49m[43m,[49m
[1;32m   3116[0m [43m    [49m[43mengine[49m[43m,[49m
[1;32m   3117[0m [43m    [49m[43mcompression[49m[38;5;241;43m=[39;49m[43mcompression[49m[43m,[49m
[1;32m   3118[0m [43m    [49m[43mindex[49m[38;5;241;43m=[39;49m[43mindex[49m[43m,[49m
[1;32m   3119[0m [43m    [49m[43mpartition_cols[49m[38;5;241;43m=[39;49m[43mpartition_cols[49m[43m,[49m
[1;32m   3120[0m [43m    [49m[43mstorage_options[49m[38;5;241;43m=[39;49m[43mstorage_options[49m[43m,[49m
[1;32m   3121[0m [43m    [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m,[49m
[1;32m   3122[0m [43m[49m[43m)[49m

File [0;32m~/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/pandas/io/parquet.py:480[0m, in [0;36mto_parquet[0;34m(df, path, engine, compression, index, storage_options, partition_cols, filesystem, **kwargs)[0m
[1;32m    476[0m impl [38;5;241m=[39m get_engine(engine)
[1;32m    478[0m path_or_buf: FilePath [38;5;241m|[39m WriteBuffer[[38;5;28mbytes[39m] [38;5;241m=[39m io[38;5;241m.[39mBytesIO() [38;5;28;01mif[39;00m path [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m [38;5;28;01melse[39;00m path
[0;32m--> 480[0m [43mimpl[49m[38;5;241;43m.[39;49m[43mwrite[49m[43m([49m
[1;32m    481[0m [43m    [49m[43mdf[49m[43m,[49m
[1;32m    482[0m [43m    [49m[43mpath_or_buf[49m[43m,[49m
[1;32m    483[0m [43m    [49m[43mcompression[49m[38;5;241;43m=[39;49m[43mcompression[49m[43m,[49m
[1;32m    484[0m [43m    [49m[43mindex[49m[38;5;241;43m=[39;49m[43mindex[49m[43m,[49m
[1;32m    485[0m [43m    [49m[43mpartition_cols[49m[38;5;241;43m=[39;49m[43mpartition_cols[49m[43m,[49m
[1;32m    486[0m [43m    [49m[43mstorage_options[49m[38;5;241;43m=[39;49m[43mstorage_options[49m[43m,[49m
[1;32m    487[0m [43m    [49m[43mfilesystem[49m[38;5;241;43m=[39;49m[43mfilesystem[49m[43m,[49m
[1;32m    488[0m [43m    [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m,[49m
[1;32m    489[0m [43m[49m[43m)[49m
[1;32m    491[0m [38;5;28;01mif[39;00m path [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m:
[1;32m    492[0m     [38;5;28;01massert[39;00m [38;5;28misinstance[39m(path_or_buf, io[38;5;241m.[39mBytesIO)

File [0;32m~/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/pandas/io/parquet.py:198[0m, in [0;36mPyArrowImpl.write[0;34m(self, df, path, compression, index, storage_options, partition_cols, filesystem, **kwargs)[0m
[1;32m    195[0m     merged_metadata [38;5;241m=[39m {[38;5;241m*[39m[38;5;241m*[39mexisting_metadata, [38;5;241m*[39m[38;5;241m*[39mdf_metadata}
[1;32m    196[0m     table [38;5;241m=[39m table[38;5;241m.[39mreplace_schema_metadata(merged_metadata)
[0;32m--> 198[0m path_or_handle, handles, filesystem [38;5;241m=[39m [43m_get_path_or_handle[49m[43m([49m
[1;32m    199[0m [43m    [49m[43mpath[49m[43m,[49m
[1;32m    200[0m [43m    [49m[43mfilesystem[49m[43m,[49m
[1;32m    201[0m [43m    [49m[43mstorage_options[49m[38;5;241;43m=[39;49m[43mstorage_options[49m[43m,[49m
[1;32m    202[0m [43m    [49m[43mmode[49m[38;5;241;43m=[39;49m[38;5;124;43m"[39;49m[38;5;124;43mwb[39;49m[38;5;124;43m"[39;49m[43m,[49m
[1;32m    203[0m [43m    [49m[43mis_dir[49m[38;5;241;43m=[39;49m[43mpartition_cols[49m[43m [49m[38;5;129;43;01mis[39;49;00m[43m [49m[38;5;129;43;01mnot[39;49;00m[43m [49m[38;5;28;43;01mNone[39;49;00m[43m,[49m
[1;32m    204[0m [43m[49m[43m)[49m
[1;32m    205[0m [38;5;28;01mif[39;00m (
[1;32m    206[0m     [38;5;28misinstance[39m(path_or_handle, io[38;5;241m.[39mBufferedWriter)
[1;32m    207[0m     [38;5;129;01mand[39;00m [38;5;28mhasattr[39m(path_or_handle, [38;5;124m"[39m[38;5;124mname[39m[38;5;124m"[39m)
[1;32m    208[0m     [38;5;129;01mand[39;00m [38;5;28misinstance[39m(path_or_handle[38;5;241m.[39mname, ([38;5;28mstr[39m, [38;5;28mbytes[39m))
[1;32m    209[0m ):
[1;32m    210[0m     [38;5;28;01mif[39;00m [38;5;28misinstance[39m(path_or_handle[38;5;241m.[39mname, [38;5;28mbytes[39m):

File [0;32m~/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/pandas/io/parquet.py:140[0m, in [0;36m_get_path_or_handle[0;34m(path, fs, storage_options, mode, is_dir)[0m
[1;32m    130[0m handles [38;5;241m=[39m [38;5;28;01mNone[39;00m
[1;32m    131[0m [38;5;28;01mif[39;00m (
[1;32m    132[0m     [38;5;129;01mnot[39;00m fs
[1;32m    133[0m     [38;5;129;01mand[39;00m [38;5;129;01mnot[39;00m is_dir
[0;32m   (...)[0m
[1;32m    138[0m     [38;5;66;03m# fsspec resources can also point to directories[39;00m
[1;32m    139[0m     [38;5;66;03m# this branch is used for example when reading from non-fsspec URLs[39;00m
[0;32m--> 140[0m     handles [38;5;241m=[39m [43mget_handle[49m[43m([49m
[1;32m    141[0m [43m        [49m[43mpath_or_handle[49m[43m,[49m[43m [49m[43mmode[49m[43m,[49m[43m [49m[43mis_text[49m[38;5;241;43m=[39;49m[38;5;28;43;01mFalse[39;49;00m[43m,[49m[43m [49m[43mstorage_options[49m[38;5;241;43m=[39;49m[43mstorage_options[49m
[1;32m    142[0m [43m    [49m[43m)[49m
[1;32m    143[0m     fs [38;5;241m=[39m [38;5;28;01mNone[39;00m
[1;32m    144[0m     path_or_handle [38;5;241m=[39m handles[38;5;241m.[39mhandle

File [0;32m~/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/pandas/io/common.py:749[0m, in [0;36mget_handle[0;34m(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)[0m
[1;32m    747[0m [38;5;66;03m# Only for write methods[39;00m
[1;32m    748[0m [38;5;28;01mif[39;00m [38;5;124m"[39m[38;5;124mr[39m[38;5;124m"[39m [38;5;129;01mnot[39;00m [38;5;129;01min[39;00m mode [38;5;129;01mand[39;00m is_path:
[0;32m--> 749[0m     [43mcheck_parent_directory[49m[43m([49m[38;5;28;43mstr[39;49m[43m([49m[43mhandle[49m[43m)[49m[43m)[49m
[1;32m    751[0m [38;5;28;01mif[39;00m compression:
[1;32m    752[0m     [38;5;28;01mif[39;00m compression [38;5;241m!=[39m [38;5;124m"[39m[38;5;124mzstd[39m[38;5;124m"[39m:
[1;32m    753[0m         [38;5;66;03m# compression libraries do not like an explicit text-mode[39;00m

File [0;32m~/github_public/Metodos-Estadisticos/venv/lib/python3.10/site-packages/pandas/io/common.py:616[0m, in [0;36mcheck_parent_directory[0;34m(path)[0m
[1;32m    614[0m parent [38;5;241m=[39m Path(path)[38;5;241m.[39mparent
[1;32m    615[0m [38;5;28;01mif[39;00m [38;5;129;01mnot[39;00m parent[38;5;241m.[39mis_dir():
[0;32m--> 616[0m     [38;5;28;01mraise[39;00m [38;5;167;01mOSError[39;00m([38;5;124mrf[39m[38;5;124m"[39m[38;5;124mCannot save file into a non-existent directory: [39m[38;5;124m'[39m[38;5;132;01m{[39;00mparent[38;5;132;01m}[39;00m[38;5;124m'[39m[38;5;124m"[39m)

[0;31mOSError[0m: Cannot save file into a non-existent directory: 'data'

